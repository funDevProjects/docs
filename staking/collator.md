# Collator

Before you continue, check if you completed all steps before creating your own collator.

* Read introduction to [Pontem staking](./README.md).
* Account on Pontem network contains at least +101 PONT coins to create collator and pay network fees:
  * Create account using [UI](../getting_started/ui.md#account-creation) or use [CLI](../getting_started/cli.md#account-creation).
  * You can use [FAUCET](https://t.me/pontem_faucet_bot) to get free tokens.
* Synchronized [bootstrap](https://github.com/pontem-network/bootstrap) node. Read [docs](https://github.com/pontem-network/bootstrap) in the repository to up your own node.
* Collator Nimbus key (you create it during initializing your bootstrap node).

After you completed all previous required steps, you can start with the process of collator creation.

## Map author to your account id

Before you create collateral you need to map your node Nimbus key with your account. 

It's done in such way because of security purposes:

* Your node generates new blocks using the Nimbus key, yet you don't share your account key where you can store funds etc.
* All rewards generated by your collator going to your account (not Nimbus one). 

Copy public key from your bootstrap node:

**IMPORTANT:** use same mnemonic you used during creation of your bootstrap node!

```sh
# Replace <you_mnemonic> with your mnemonic phrase.
docker-compose run pontem-node pontem key inspect --keystore-path /opt/pontem/keys "<you_mnemonic>"
```

You will see something like it in the output:

```sh
Secret Key URI `//Bob` is account:
Secret seed:       0x02ca07977bdc4c93b5e00fcbb991b4e8ae20d05444153fd968e04bed6b4946e7
Public key (hex):  0xb832ced5ca2de9fe76ef101d8ab1b8dd778e1ab5a809d019c57b78e45ecbaa56
Public key (SS58): 5GEDm6TY5apP4bhwuTtTzA7z9vHbCL1V2D5nE8sPga6WKhNH
Account ID:        0xb832ced5ca2de9fe76ef101d8ab1b8dd778e1ab5a809d019c57b78e45ecbaa56
SS58 Address:      5GEDm6TY5apP4bhwuTtTzA7z9vHbCL1V2D5nE8sPga6WKhNH
```

Copy `Public key (hex)` as your public key, it's going to be your validator public key. 

Now you need to map your public key with your account:

1. Navigate to [extrinsics](https://polkadot.js.org/apps/?rpc=wss://testnet.pontem.network/ws#/extrinsics).
2. Choose `authorMapping` pallet.
3. Choose `addAssociation(author_id)` function.
4. Put your public key in `author_id` field.
5. Send transaction from your account.

After the transaction is executed you will lose 1 PONT coin as a reserved amount for mapping public key. If you don't want to participate anymore, you can get your PONT back by calling the `clearAssociation` method of the same pallet.

![Check Mapping](/assets/author_mapping.png "Author Mapping")

Let's check that author mapped correctly:

1. Navigate to [storage](https://polkadot.js.org/apps/?rpc=wss%3A%2F%2Ftestnet.pontem.network%2Fws#/chainstate)
2. Choose `authorMapping` pallet.
3. Choose `mappingWithDeposit(AuthorId)`
4. Put your public key in `AuthorId` field.
5. Make call.

![Check Mapping](/assets/check_author_mapping.png "Check Mapping")

## Become collator

You need to query current amount of collator candidates.

1. Navigate to [Pontem UI. Javascript](https://polkadot.js.org/apps/?rpc=wss%3A%2F%2Ftestnet.pontem.network%2Fws#/js)
2. Execute there following code (remove pre-defined code before):

```js
// Simple script to get candidate pool size
const candidatePool = await api.query.parachainStaking.candidatePool();
console.log(`Candidate pool size is: ${candidatePool.length}`);
```

Copy printed number after `Candidate pool size is:`.

![Candidate Pool](/assets/candidate_pool.png "Candidate Pool")

Create your collator candidate:

1. Navigate to [extrinsics](https://polkadot.js.org/apps/?rpc=wss://testnet.pontem.network/ws#/extrinsics).
2. Choose `parachainStaking` pallet.
3. Choose `joinCandidates(bond, candidate_count)` function.
4. Put amount to bond in PONT tokens (at least 100 PONT, but we recommend to put at least 1000 PONT).
5. For `candidate_count` use value you copied in the previous step.
6. Send transaction from your account.

![Join Candidatess](/assets/candidate_pool.png "Join Candidates")

It's all, once your collator reaches top you will become active and start generating blocks. 

**Also, you need to wait at least 1 round to make changes appear (same required for almost any other staking related methods and changes).**

## Self Stake

You can self-stake more for your collator, use the `parachainStaking` pallet and `candidateBondMore` method, you can get your staked coins back using `candidateBondLess` method.

## Go Offline

You can go offline as collator using the `parachainStaking` pallet and `goOffline()` method, after you are ready again to produce blocks: send transaction contains method `goOnline`.

## Leave Candidates

If you want to leave collators list send a transaction contains method `leaveCandidates`, you will leave in the next round, get self-stake back and your nominators also will get their stakes back.

## More

1. Navigate to [extrinsics](https://polkadot.js.org/apps/?rpc=wss://testnet.pontem.network/ws#/extrinsics).
2. Choose `parachainStaking` pallet.
3. Scroll methods list and review methods descriptions.

## Useful links

Staking that Pontem network uses initially implemented by [Moonbeam team](https://moonbeam.network/), we also refer to their [documentation](https://docs.moonbeam.network/learn/features/staking/) that very useful.
